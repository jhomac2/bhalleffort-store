<script>
    /* ---------- LISTA DE PRODUCTOS (con nuevos productos del Excel) ---------- */
    const productos = [
      /* ROPA */
      {id:"R001",cat:"Ropa",nombre:"Jeans cl√°sicos elasticados",precio:15.00,img:"prod-jeans.jpg",url:"ropa.html"},
      {id:"R002",cat:"Ropa",nombre:"Blusa de seda sin mangas",precio:8.00,img:"prod-blusa.jpg",url:"ropa.html"},
      {id:"R003",cat:"Ropa",nombre:"Falda de verano estampada",precio:10.00,img:"prod-falda.jpg",url:"ropa.html"},
      {id:"R004",cat:"Ropa",nombre:"Vestido de c√≥ctel negro",precio:18.00,img:"prod-vestido.jpg",url:"ropa.html"},
      {id:"R005",cat:"Ropa",nombre:"Camiseta deportiva Dry-Fit",precio:7.00,img:"prod-camiseta.jpg",url:"ropa.html"},
      {id:"R006",cat:"Ropa",nombre:"Chaqueta estilo aviador",precio:25.00,img:"prod-chaqueta.jpg",url:"ropa.html"},
      {id:"R007",cat:"Ropa",nombre:"Pack 3 pares calcetines",precio:4.50,img:"prod-calcetines.jpg",url:"ropa.html"},
      /* ZAPATOS */
      {id:"Z001",cat:"Zapatos",nombre:"Tenis urbanos unisex",precio:22.00,img:"prod-tenis.jpg",url:"ropa.html"},
      {id:"Z002",cat:"Zapatos",nombre:"Zapatos formales cuero",precio:35.00,img:"prod-zapato-cuero.jpg",url:"ropa.html"},
      {id:"Z003",cat:"Zapatos",nombre:"Sandalias playeras",precio:12.00,img:"prod-sandalias.jpg",url:"ropa.html"},
      {id:"Z004",cat:"Zapatos",nombre:"Botines taco medio",precio:28.00,img:"prod-botines.jpg",url:"ropa.html"},
      /* NUEVOS PRODUCTOS DESDE EXCEL */
      {id:"R008",cat:"Ropa",nombre:"Camisa de mujer Talla √∫nica",precio:7.00,img:"prod-camisa-de-mujer-talla-unica.webp",url:"ropa.html"},
      {id:"R009",cat:"Ropa",nombre:"Blusa blanca Talla √∫nica Colores blanco-negro",precio:5.00,img:"prod-blusa-blanca-talla-unica--colores-blanco-negro.webp",url:"ropa.html"},
      {id:"R010",cat:"Ropa",nombre:"Chompa de hombre Talla M Colores rojo-negro",precio:10.00,img:"prod-chompa-de-hombre-talla-m-colores-rojo-negro.webp",url:"ropa.html"},
      {id:"R011",cat:"Ropa",nombre:"Chompas con capuchas para hombres Talla M Colores plomo-negro",precio:10.00,img:"prod-chompas-con-capuchas-para-hombres-talla-m-colores-plomo-negro.webp",url:"ropa.html"},
      {id:"R012",cat:"Ropa",nombre:"Chaqueta casual en gabardina Talla S-M-L-XL Colores Negro-Manteca",precio:20.00,img:"prod-chaqueta-casual-en-gabardina-talla-s-m-l-xl-colores-negro-manteca.webp",url:"ropa.html"},
      {id:"R013",cat:"Ropa",nombre:"Buzo tipo chompa para hombre Talla L √önico color",precio:15.00,img:"prod-buzo-tipo-chompa-para-hombre-talla-I-unico-color.webp",url:"ropa.html"},
      {id:"R014",cat:"Ropa",nombre:"Chompa abrigada de felpa Talla L",precio:10.00,img:"prod-chompa-abrigada-de-felpa-talla-I.webp",url:"ropa.html"},
      {id:"Z005",cat:"Zapatos",nombre:"Tacos triple banda Talla Color oro",precio:20.00,img:"prod-tacos--triple-banda-talla-color-oro.webp",url:"ropa.html"},
      {id:"Z006",cat:"Zapatos",nombre:"Tacos doble banda Talla Color oro",precio:20.00,img:"prod-tacos--doble-banda-talla-color-oro.webp",url:"ropa.html"},
      {id:"R015",cat:"Ropa",nombre:"Buzo tipo licra para ejercicio Talla M Colores negro-rojo-azul",precio:5.00,img:"prod-buzo-tipo-licra-para-ejercicio-talla-m-colores-negro-rojo-azul.webp",url:"ropa.html"},
      {id:"Z007",cat:"Zapatos",nombre:"Tacos mariposa Talla M Color Negro",precio:17.00,img:"prod-tacos-mariposa-talla-m-color-negro.webp",url:"ropa.html"},
      {id:"Z008",cat:"Zapatos",nombre:"Zapatos deportivos de mujer Talla M Colores blanco-negro",precio:18.00,img:"prod-zapatos-deportivos-de-mujer-talla-m-colores-blanco-negro.webp",url:"ropa.html"},
      {id:"R016",cat:"Ropa",nombre:"Buzo tejido para mujer Talla M √önico color",precio:15.00,img:"prod-buzo-tejido-para-mujer-talla-m-unico-color-.webp",url:"ropa.html"},
      {id:"R017",cat:"Ropa",nombre:"Chompa hombre Talla M Color negro",precio:15.00,img:"prod-chompa-hombre-talla-m-color-negro.webp",url:"ropa.html"}
    ];

    let carrito = JSON.parse(localStorage.getItem('bh-cart')) || [];

    /* ---------- RESTO DEL C√ìDIGO (sin cambios) ---------- */
    function getSorteoCount() {
      const ahora = new Date();
      const key = `sorteo-${ahora.getFullYear()}-${ahora.getMonth()}`;
      return parseInt(localStorage.getItem(key) || '20');
    }
    function incrementSorteo() {
      const ahora = new Date();
      const key = `sorteo-${ahora.getFullYear()}-${ahora.getMonth()}`;
      let count = parseInt(localStorage.getItem(key) || '20');
      count++;
      localStorage.setItem(key, count);
      return count;
    }

    function dibujarProductos() {
      const grid = document.getElementById('products-grid');
      grid.innerHTML = productos.map(p => `
        <div class="product-card">
          <img src="${p.img}" alt="${p.nombre}" class="product-image">
          <div class="product-info">
            <span class="product-category">${p.cat}</span>
            <h4 class="product-name">${p.nombre}</h4>
            <div class="current-price">$${p.precio.toFixed(2)}</div>
            <button class="btn-buy" onclick="addCart('${p.id}','${p.nombre}',${p.precio})">A√±adir al carrito</button>
          </div>
        </div>`).join('');
    }

    function addCart(id,nombre,precio) {
      carrito.push({id,nombre,precio});
      localStorage.setItem('bh-cart',JSON.stringify(carrito));
      actualizarBadge();
      mostrarNoti(`‚úÖ ${nombre} a√±adido al carrito`);
      actualizarBannerEnvio();
      if (carrito.length === 1) mostrarNoti('üöö Por compras mayores a $50 tu env√≠o es gratuito', 10000);
    }

    function actualizarBadge() {
      document.getElementById('cart-badge').textContent = carrito.length;
    }

    function actualizarBannerEnvio() {
      const total = carrito.reduce((t,p)=>t+p.precio,0);
      const bannerEnvio = document.getElementById('banner-envio');
      const bannerSorteo = document.getElementById('banner-sorteo');
      if (total >= 50) {
        bannerEnvio.innerHTML = '‚úÖ ¬°Tu env√≠o es gratis!';
        bannerEnvio.style.background = '#25D366';
      } else {
        bannerEnvio.innerHTML = 'üöö ¬°Env√≠o gratis desde $50!';
        bannerEnvio.style.background = '#ff9800';
      }
      if (total >= 20) {
        bannerSorteo.innerHTML = 'üéâ ¬°YA EST√ÅS PARTICIPANDO EN EL SORTEO MENSUAL!';
        bannerSorteo.style.background = 'var(--morado)';
      } else {
        bannerSorteo.innerHTML = 'üéâ Por compras superiores a $20 participas en el sorteo mensual';
        bannerSorteo.style.background = 'var(--morado)';
      }
    }

    function mostrarNoti(texto, tiempo = 2000) {
      const noti = document.getElementById('noti-add');
      noti.textContent = texto;
      noti.style.display = 'block';
      setTimeout(() => noti.style.display = 'none', tiempo);
    }

    function mostrarModal() {
      const modal = document.getElementById('cart-modal');
      const items = document.getElementById('cart-items');
      const total = carrito.reduce((t,p)=>t+p.precio,0);
      items.innerHTML = carrito.map((p,i)=>`
        <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #eee">
          <span>${p.nombre} <br><small>$${p.precio.toFixed(2)}</small></span>
          <button onclick="removeItem(${i})" style="background:none;border:none;color:red;cursor:pointer">üóëÔ∏è</button>
        </div>`).join('');
      document.getElementById('cart-total').textContent = '$'+total.toFixed(2);
      modal.style.display = 'block';
    }
    function removeItem(i) {
      carrito.splice(i,1);
      localStorage.setItem('bh-cart',JSON.stringify(carrito));
      actualizarBadge();
      actualizarBannerEnvio();
      mostrarModal();
    }
    document.getElementById('close-cart').onclick = () => document.getElementById('cart-modal').style.display = 'none';
    document.getElementById('cart-icon').onclick = mostrarModal;

    document.getElementById('btn-wa').onclick = () => {
      const subtotal = carrito.reduce((t,p)=>t+p.precio,0);
      const envio = subtotal >= 50 ? 0 : 3.50;
      const total = subtotal + envio;
      let texto = `üêã Hola, quiero:\n`;
      texto += carrito.map(p => `‚Ä¢ ${p.nombre}  $${p.precio.toFixed(2)}`).join('\n');
      texto += `\nTotal productos: $${subtotal.toFixed(2)}`;
      if (envio > 0) texto += `\nEnv√≠o: $${envio.toFixed(2)}`;
      else texto += '\nEnv√≠o: ¬°Gratis!';
      texto += `\nTOTAL A PAGAR: $${total.toFixed(2)}`;
      if (subtotal >= 20) {
        const count = incrementSorteo();
        texto += `\n\nüéâ ¬°Felicidades! Est√°s participando en el sorteo mensual üíúüòÉ\nTu c√≥digo de participaci√≥n te lo dar√° el vendedor.`;
      }
      window.open(`https://wa.me/593963923399?text= ${encodeURIComponent(texto)}`, '_blank');
    };

    document.getElementById('btn-lupa').onclick = () => document.getElementById('search-modal').style.display = 'block';
    document.getElementById('close-search').onclick = () => document.getElementById('search-modal').style.display = 'none';
    document.getElementById('search-input').oninput = () => {
      const q = document.getElementById('search-input').value.toLowerCase();
      const filtrados = productos.filter(p => p.nombre.toLowerCase().includes(q));
      document.getElementById('search-results').innerHTML = filtrados.map(p => `
        <div class="result-item" onclick="window.open('${p.url}','_self')">
          <strong>${p.nombre}</strong> - $${p.precio.toFixed(2)}
        </div>`).join('');
    };

    document.getElementById('menu-toggle').onclick = () => {
      document.getElementById('nav-menu').classList.toggle('show');
    };

    dibujarProductos();
    actualizarBadge();
    actualizarBannerEnvio();
</script>
