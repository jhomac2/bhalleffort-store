<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>RIFAS | BHALLEFFORT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="https://jhomac2.github.io/bhalleffort-store/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --celeste: #87ceeb;
      --morado: #4c0d8c;
      --turquesa: #00c8c8;
      --fondo: #eef2f7;
      --naranja: #ff6600;
      --oro: #ffd700;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
    body { background: var(--fondo); color: #222; line-height: 1.6; }
    
    .container { width: 90%; max-width: 1200px; margin: auto; }
    .flex-space { display: flex; align-items: center; justify-content: space-between; }

    /* HEADER & NAV */
    .main-header { padding: 15px 0; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,.1); }
    .whale-icon { width: 70px; border: 2px solid var(--morado); border-radius: 50%; }
    .main-nav { position: sticky; top: 0; z-index: 999; background: #fff; border-bottom: 2px solid var(--morado); }
    .main-nav ul { list-style: none; display: flex; justify-content: center; flex-wrap: wrap; }
    .main-nav a { color: var(--morado); padding: 12px 15px; display: block; text-decoration: none; font-weight: 600; font-size: 14px; }
    .main-nav a.active { background: var(--morado); color: #fff; }

    /* HERO */
    .hero-rifas { background: linear-gradient(45deg, var(--morado), var(--naranja)); color: #fff; padding: 60px 20px; text-align: center; }
    .hero-rifas h1 { font-size: 35px; text-transform: uppercase; margin-bottom: 10px; }

    /* GRID DE RIFAS */
    .rifas-grid { display: grid; gap: 25px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); padding: 40px 0; }
    .rifa-card { background: #fff; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.1); border: 2px solid var(--oro); transition: 0.3s; }
    .rifa-card:hover { transform: translateY(-5px); }
    .rifa-img { width: 100%; height: 250px; object-fit: cover; }
    .rifa-info { padding: 20px; text-align: center; }
    .rifa-tag { background: var(--naranja); color: #fff; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; }
    .price-tag { font-size: 24px; color: var(--morado); font-weight: 800; margin: 10px 0; }
    
    .btn-add { background: var(--morado); color: #fff; border: none; padding: 12px 25px; border-radius: 30px; cursor: pointer; font-weight: bold; width: 100%; }

    /* CARRITO ICON */
    #cart-trigger { position: fixed; top: 20px; right: 20px; background: #fff; width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer; z-index: 1001; }
    #cart-count { position: absolute; top: 0; right: 0; background: var(--naranja); color: #fff; font-size: 12px; padding: 3px 7px; border-radius: 50%; }

    /* MODAL */
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; }
    .modal-content { background: #fff; width: 90%; max-width: 450px; margin: 50px auto; border-radius: 15px; padding: 20px; position: relative; }
  </style>
</head>
<body>

  <div id="cart-trigger">
    <i class="fas fa-ticket-alt" style="font-size: 24px; color: var(--morado);"></i>
    <span id="cart-count">0</span>
  </div>

  <header class="main-header">
    <div class="container flex-space">
      <div style="display:flex; align-items:center; gap:15px;">
        <img src="logo-ballena.png" class="whale-icon" alt="Logo">
        <div>
          <h2 style="color:var(--morado); line-height:1;">BHALLEFFORT</h2>
          <small>Suerte y Estilo</small>
        </div>
      </div>
      <a href="https://wa.me/593963923399" style="background:#25d366; color:#fff; padding:10px 15px; border-radius:5px; text-decoration:none; font-weight:bold; font-size:12px;">
        <i class="fab fa-whatsapp"></i> SOPORTE RIFAS
      </a>
    </div>
  </header>

  <nav class="main-nav">
    <ul>
      <li><a href="index.html">INICIO</a></li>
      <li><a href="ropa.html">ROPA</a></li>
      <li><a href="zapatos.html">ZAPATOS</a></li>
      <li><a href="varios.html">VARIOS</a></li>
      <li><a href="rifas.html" class="active">RIFAS</a></li>
      <li><a href="quienes-somos.html">NOSOTROS</a></li>
    </ul>
  </nav>

  <section class="hero-rifas">
    <div class="container">
      <h1>üé∞ Sorteos Activos üé∞</h1>
      <p>Compra tu boleto y participa por premios incre√≠bles. ¬°Toda la suerte!</p>
    </div>
  </section>

  <main class="container">
    <div class="rifas-grid" id="rifas-display">
      </div>
  </main>

  <div id="cart-modal" class="modal">
    <div class="modal-content">
      <h3 style="margin-bottom:15px; border-bottom:2px solid var(--fondo); padding-bottom:10px;">üéüÔ∏è Mis Boletos y Productos</h3>
      <div id="cart-items-list" style="max-height: 300px; overflow-y: auto;"></div>
      <div style="margin-top:20px; border-top:2px solid var(--fondo); padding-top:15px;">
        <div class="flex-space" style="font-weight:bold; font-size:18px; margin-bottom:15px;">
          <span>Total:</span> <span id="cart-total-price">$0.00</span>
        </div>
        <button onclick="enviarWhatsApp()" style="background:#25d366; color:#fff; width:100%; border:none; padding:15px; border-radius:10px; font-weight:bold; cursor:pointer;">
          <i class="fab fa-whatsapp"></i> FINALIZAR COMPRA / RESERVA
        </button>
        <button onclick="cerrarModal()" style="width:100%; background:none; border:none; margin-top:10px; color:#888; cursor:pointer;">Continuar viendo</button>
      </div>
    </div>
  </div>

  <script>
    // Conexi√≥n con el Carrito Global
    let carrito = JSON.parse(localStorage.getItem('bh-cart')) || [];
    let todosLosProductos = [];

    async function cargarRifas() {
      try {
        const respuesta = await fetch('productos.json');
        todosLosProductos = await respuesta.json();
        
        // Filtramos solo los productos de la categor√≠a RIFAS
        const rifas = todosLosProductos.filter(p => p.cat.toUpperCase() === "RIFAS");
        renderizarRifas(rifas);
      } catch (error) {
        console.error("Error cargando el JSON:", error);
      }
    }

    function renderizarRifas(lista) {
      const contenedor = document.getElementById('rifas-display');
      contenedor.innerHTML = lista.map(p => `
        <div class="rifa-card">
          <img src="${p.imgFrontal}" class="rifa-img" alt="${p.nombre}">
          <div class="rifa-info">
            <span class="rifa-tag">üçÄ Cupos: ${p.stock || 'Disponibles'}</span>
            <h3 style="margin-top:10px;">${p.nombre}</h3>
            <p style="font-size:13px; color:#666; height:40px; overflow:hidden;">${p.descripcion || ''}</p>
            <div class="price-tag">$${p.precio.toFixed(2)}</div>
            <button class="btn-add" onclick="agregarAlCarrito('${p.id}')">
              ADQUIRIR BOLETO
            </button>
          </div>
        </div>
      `).join('');
    }

    function agregarAlCarrito(id) {
      const producto = todosLosProductos.find(p => p.id === id);
      carrito.push(producto);
      localStorage.setItem('bh-cart', JSON.stringify(carrito));
      actualizarInterfaz();
    }

    function actualizarInterfaz() {
      document.getElementById('cart-count').textContent = carrito.length;
      dibujarCarrito();
    }

    function dibujarCarrito() {
      const listaHTML = document.getElementById('cart-items-list');
      let total = 0;

      if (carrito.length === 0) {
        listaHTML.innerHTML = "<p style='text-align:center; color:#888;'>El carrito est√° vac√≠o.</p>";
      } else {
        listaHTML.innerHTML = carrito.map((p, index) => {
          total += p.precio;
          return `
            <div class="flex-space" style="margin-bottom:10px; background:var(--fondo); padding:10px; border-radius:8px;">
              <div>
                <strong style="font-size:13px;">${p.nombre}</strong><br>
                <small>$${p.precio.toFixed(2)}</small>
              </div>
              <button onclick="eliminarDelCarrito(${index})" style="color:red; border:none; background:none; cursor:pointer;">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          `;
        }).join('');
      }
      document.getElementById('cart-total-price').textContent = `$${total.toFixed(2)}`;
    }

    function eliminarDelCarrito(index) {
      carrito.splice(index, 1);
      localStorage.setItem('bh-cart', JSON.stringify(carrito));
      actualizarInterfaz();
    }

    function enviarWhatsApp() {
      if (carrito.length === 0) return alert("El carrito est√° vac√≠o");
      
      let mensaje = "üêã *NUEVO PEDIDO BHALLEFFORT*\n\n";
      let total = 0;
      
      carrito.forEach((p, i) => {
        mensaje += `${i+1}. ${p.nombre} - $${p.precio.toFixed(2)}\n`;
        total += p.precio;
      });
      
      mensaje += `\nüí∞ *TOTAL:* $${total.toFixed(2)}`;
      mensaje += `\nüìå *Nota:* Por favor confirmar disponibilidad de n√∫meros de rifa.`;
      
      window.open(`https://wa.me/593963923399?text=${encodeURIComponent(mensaje)}`);
    }

    // Control del Modal
    document.getElementById('cart-trigger').onclick = () => document.getElementById('cart-modal').style.display = 'block';
    function cerrarModal() { document.getElementById('cart-modal').style.display = 'none'; }
    window.onclick = (event) => { if (event.target.className === 'modal') cerrarModal(); }

    // Inicio
    cargarRifas();
    actualizarInterfaz();
  </script>
</body>
</html>
